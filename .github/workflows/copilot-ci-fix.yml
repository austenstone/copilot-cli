on:
  workflow_run:
    workflows: [CI] # add workflows here
    types: [completed]

jobs:
  on-failure:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'failure' }}
    steps:
      - uses: austenstone/copilot-cli-actions/.github/actions/copilot@main
        with:
          github-token: ${{ secrets.PAT }}
          prompt: |
            The GitHub Actions workflow run failed.
            Please analyze the failure and suggest a fix.
            Create a pull request with the necessary changes.
            Include the error logs and any relevant information.

            At the end, summarize the outcome of your task using "actions-toolkit-mcp" mcp tool

            Workflow Run: ${{ github.event.workflow_run.url }}
            GitHub Context: ${{ toJson(github) }}