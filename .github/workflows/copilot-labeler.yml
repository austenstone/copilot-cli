on:
  issues:
    types: [opened]
  pull_request:
    types: [opened]
    branches:
      - 'main'

jobs:
  triage:
    runs-on: ubuntu-latest
    timeout-minutes: 7
    permissions:
      contents: 'read'
      issues: 'write'
      pull-requests: 'read'
    steps:
      - uses: austenstone/copilot-cli@main
        env:
          ISSUE_TITLE: '${{ github.event.issue.title }}'
          ISSUE_BODY: '${{ github.event.issue.body }}'
        with:
          copilot-token: ${{ secrets.PAT }}
          prompt: |
            ## Role

            You are an issue triage assistant. Analyze the current GitHub issue and identify the most appropriate existing labels. Use the available tools to gather information; do not ask for information to be provided.

            ## Guidelines

            - Only use labels that are from the list of available labels.
            - You can choose multiple labels to apply.

            ## Input Data

            **Issue Title**:
            ```
            ${{ env.ISSUE_TITLE }}
            ```

            **Issue Body**:
            ```
            ${{ env.ISSUE_BODY }}
            ```

            **Issue Number**:
            ```
            ${{ github.event.issue.number }}
            ```

            ## Steps

            0. Fetch possible labels from the repository.

            1. Review the issue title, issue body, and available labels provided above.

            2. Based on the issue title and issue body, classify the issue and choose all appropriate labels from the list of available labels.

            3. Use the `issue_write` tool to update the issue with the selected labels:
               - Set `method` to `'update'`
               - Set `issue_number` to the issue number provided above
               - Set `labels` to an array of the appropriate label names from the available labels
               - Do not modify the issue body or other properties
